# 創世紀元：異世界創作神器

一款基於 AI 的輕小說創作工具，整合 Ollama 本地 AI 引擎，為中文輕小說創作者提供智能寫作輔助。

## 🚀 開發狀態

**當前版本：v0.3.7**  
**開發進度：IPC 處理器註冊問題修復完成 100%，所有 IPC 功能正常運作，OLLAMA 模型獲取功能完全修復**

### ✅ 已完成功能

- 🌟 **創世神模式**：完整的專案管理系統，支援多專案創作
- ⚔️ **英靈召喚**：AI 輔助角色創造與管理，支援角色關係網路
- 📝 **章節式編輯器**：基於 Slate.js 的富文本編輯器，支援自動儲存
- 🔮 **預言書寫**：智能續寫與劇情建議，整合 Ollama AI 引擎
- 🎭 **輕小說模板**：異世界、校園、科幻、奇幻四大類型模板
- 💾 **資料管理**：SQLite 資料庫，支援備份還原和資料庫維護
- 🎨 **星空主題**：深藍色星空背景配金色魔法陣的動漫風格界面
- 🧪 **完整測試**：單元測試、整合測試、性能測試全覆蓋

### 🔄 最新完成功能

- 🛡️ **穩定性大幅優化**：解決應用程式閃退問題，實現長時間穩定運行
- 💾 **真實資料庫保存**：實現章節內容真正保存到 SQLite 資料庫
- 🔧 **錯誤處理完善**：多層錯誤捕獲機制，防止崩潰並提供友好錯誤提示
- ⚡ **IPC 通訊優化**：重新架構主進程與渲染進程通訊，確保資料傳輸穩定
- 🔄 **自動更新系統**：完整的應用程式更新機制，支援版本檢查和自動下載
- 📖 **完整用戶文檔**：使用手冊、快速入門指南、常見問題解答系統
- 📋 **診斷工具**：系統環境檢查和問題排查工具
- 🚀 **一鍵安裝**：自動化安裝腳本，簡化環境配置流程

### 🔄 開發中功能

- 🎨 **幻想具現**：AI 插畫生成功能（規劃中）
- 📚 **傳說編纂**：一鍵生成專業電子書（規劃中）

## 功能特色

## 技術架構

- **前端**: React 18 + TypeScript + Tailwind CSS
- **後端**: Electron + Node.js
- **資料庫**: SQLite
- **AI 引擎**: Ollama (本地)
- **狀態管理**: Redux Toolkit
- **編輯器**: Slate.js

## 開發環境需求

- Node.js 18+
- npm 或 yarn
- Ollama (用於 AI 功能)

## 🚀 快速安裝

### 🌟 一鍵安裝（推薦）

```bash
# 克隆專案
git clone <repository-url>
cd genesis-chronicle

# 執行自動安裝腳本
node scripts/quick-install.js

# 啟動應用程式
./start-dev.sh    # macOS/Linux
# 或
start-dev.bat     # Windows
```

### 📝 手動安裝

```bash
# 1. 安裝依賴
npm install

# 2. 重建原生模組（重要！）
npm rebuild better-sqlite3

# 3. 測試編譯
npm run build

# 4. 啟動開發環境
npm run dev
```

### 🤖 AI 功能設置（可選）

1. 前往 [ollama.ai](https://ollama.ai) 下載並安裝 Ollama
2. 啟動 Ollama 服務：
   ```bash
   ollama serve
   ```
3. 下載中文模型：
   ```bash
   ollama pull llama3.2
   ```

### 🔧 其他可用命令

```bash
# 系統診斷
npm run diagnostic

# 運行測試
npm test

# 建置應用程式
npm run build

# 打包應用程式
npm run package
```

## 專案結構

```
├── src/
│   ├── main/                          # Electron 主程序
│   │   ├── main.ts                   # 主程序入口
│   │   ├── preload.ts                # 預載腳本
│   │   ├── database/                 # 資料庫相關
│   │   │   └── database.ts           # SQLite 資料庫管理
│   │   ├── services/                 # 核心服務
│   │   │   ├── ollamaService.ts      # Ollama AI 服務
│   │   │   ├── contextManager.ts     # 上下文管理器
│   │   │   ├── updateService.ts      # 自動更新服務
│   │   │   └── databaseMaintenance.ts # 資料庫維護
│   │   ├── ipc/                      # IPC 處理器
│   │   │   ├── ipcHandlers.ts        # 主要 IPC 處理
│   │   │   ├── aiHandlers.ts         # AI 相關處理
│   │   │   └── updateHandlers.ts     # 更新相關處理
│   │   └── __tests__/                # 測試文件
│   │       ├── database/             # 資料庫測試
│   │       ├── services/             # 服務測試
│   │       ├── integration/          # 整合測試
│   │       └── performance/          # 性能測試
│   └── renderer/                     # React 前端
│       ├── src/
│       │   ├── components/           # React 組件
│       │   │   ├── Characters/       # 角色管理組件
│       │   │   ├── Editor/           # 編輯器組件
│       │   │   ├── Help/             # 幫助系統組件
│       │   │   ├── Modals/           # 對話框組件
│       │   │   ├── Update/           # 更新系統組件
│       │   │   └── UI/               # UI 組件
│       │   ├── pages/                # 頁面組件
│       │   │   ├── Dashboard/        # 儀表板
│       │   │   ├── ProjectEditor/    # 專案編輯器
│       │   │   ├── CharacterManager/ # 角色管理
│       │   │   └── Settings/         # 設定頁面
│       │   ├── store/                # Redux store
│       │   ├── services/             # 前端服務
│       │   ├── hooks/                # 自定義 hooks
│       │   └── data/                 # 資料定義
│       └── index.html
├── .kiro/                            # Kiro AI 助手設定
│   ├── steering/                     # 全局規則
│   └── specs/                        # 專案規格
├── dist/                             # 建置輸出
├── scripts/                          # 安裝和診斷腳本
│   ├── quick-install.js              # 一鍵安裝腳本
│   └── diagnostic.js                 # 系統診斷腳本
├── coverage/                         # 測試覆蓋率報告
├── run-*.js                          # 測試執行腳本
├── INSTALLATION_GUIDE.md             # 詳細安裝指南
├── README_INSTALL.md                 # 快速安裝說明
├── start-dev.sh / start-dev.bat      # 快速啟動腳本
├── package.json
└── README.md
```

## 🧪 測試

專案包含完整的測試套件，確保代碼品質和功能穩定性：

### 測試類型

- **單元測試**：核心服務和資料庫操作測試
- **整合測試**：組件互動和工作流程測試
- **性能測試**：大量資料處理和 AI 請求性能測試

### 執行測試

```bash
# 執行所有測試
npm test

# 執行單元測試
node run-unit-tests.js

# 執行整合測試
node run-integration-tests.js

# 執行性能測試
node run-performance-tests.js
```

### 測試覆蓋率

- **資料庫服務**：完整的 CRUD 操作和維護功能測試
- **AI 服務**：Ollama 整合、錯誤處理、重試機制測試
- **上下文管理**：智能上下文構建和壓縮測試
- **使用者流程**：完整的創作工作流程端到端測試

## 開發指南

### 添加新功能

1. 在 `src/main/ipc/ipcHandlers.ts` 中添加 IPC 處理器
2. 在 `src/main/preload.ts` 中暴露 API
3. 在 `src/renderer/src/store/slices/` 中添加 Redux slice
4. 在 `src/renderer/src/components/` 中創建 React 組件
5. 在 `src/main/__tests__/` 中添加對應的測試

### 資料庫操作

資料庫操作都在 `src/main/database/database.ts` 中處理，使用 better-sqlite3：

- 支援外鍵約束和級聯刪除
- 自動資料庫遷移和版本管理
- 完整的錯誤處理和事務支援

### AI 整合

AI 功能通過 Ollama API 實現：

- **服務檢測**：`src/main/services/ollamaService.ts`
- **上下文管理**：`src/main/services/contextManager.ts`
- **IPC 處理**：`src/main/ipc/aiHandlers.ts`

### 資料庫維護

內建資料庫維護功能：

- 健康檢查和問題檢測
- 自動修復和優化
- 詳細的維護報告生成

## 📈 開發里程碑

### 已完成 (v0.1.0 MVP)

- [x] 專案管理系統 - 多專案創建、管理、刪除
- [x] 角色管理系統 - 角色創建、關係管理、原型系統
- [x] 章節式編輯器 - 富文本編輯、自動儲存、章節管理
- [x] AI 智能續寫 - Ollama 整合、上下文管理、多版本生成
- [x] 輕小說模板 - 四大類型模板、角色原型、世界設定
- [x] 資料管理 - SQLite 資料庫、備份還原、維護功能
- [x] 使用者界面 - 星空主題、動畫效果、響應式設計
- [x] 測試框架 - 單元測試、整合測試、性能測試

### 已完成 (v0.2.0)

- [x] 自動更新機制 - 版本檢查、更新下載、安裝流程
- [x] 使用者文檔 - 使用手冊、快速入門、常見問題
- [x] 診斷工具 - 系統環境檢查、問題排查、報告生成
- [x] 一鍵安裝 - 自動化安裝腳本、環境配置

### 已完成 (v0.2.1) - 穩定性重大提升

- [x] 應用程式穩定性優化 - 完全解決閃退問題，實現持續穩定運行
- [x] 資料庫功能重構 - 真實的專案和章節資料保存，支援自動載入
- [x] IPC 通訊架構優化 - 重新設計主進程與渲染進程通訊，確保資料完整性
- [x] 錯誤處理機制完善 - 全域錯誤捕獲，多層錯誤邊界保護
- [x] 開發環境配置修正 - 解決環境變數和模組載入問題

### 已完成 (v0.3.0) - 應用程式打包

- [x] Electron Forge 配置 - 完成打包環境設置和配置
- [x] 功能逐步測試 - 在打包環境下進行功能驗證和穩定性測試
- [x] 安裝程式生成 - 建立跨平台安裝程式產生機制
- [x] AI 功能驗證 - Ollama 服務連接、智能續寫、上下文管理功能全部測試通過
- [x] 資料庫功能驗證 - 專案、章節、角色資料保存和載入功能測試通過
- [x] AI API 修復 - 修復 preload.ts 中 AI 功能 API 暴露問題，現在 AI 功能可在界面中正常顯示
- [x] 功能卡片恢復 - 恢復所有重要功能的儀表板卡片，包括角色管理、模板系統、資料庫維護等 10 大功能
- [x] 應用程式穩定化 - 成功修復啟動問題，使用穩定版本確保所有功能卡片正常顯示和運行

### 已完成 (v0.3.0) - 全功能測試驗證

- [x] 編輯器功能測試 - 文字輸入、保存、載入功能驗證完成
- [x] 導航系統測試 - 頁面切換、返回功能測試通過
- [x] 錯誤處理測試 - 極限輸入、快速操作、系統穩定性測試完成
- [x] 界面響應性測試 - 不同視窗大小、hover 效果、全螢幕模式測試通過
- [x] 創作統計功能測試 - 字數統計、寫作時間追蹤、每日目標管理測試完成
- [x] 儲存系統測試 - localStorage 持久化、資料完整性驗證通過
- [x] 功能卡片測試 - 10 大功能卡片界面和互動測試完成
- [x] 系統整體穩定性驗證 - 長時間運行、資源使用、記憶體管理測試通過

### 規劃中 (v1.0.0)

- [ ] AI 插畫生成 - 角色插畫、場景插畫、封面設計
- [ ] 電子書製作 - EPUB 生成、排版優化、封面設計
- [ ] 雲端同步 - 多裝置同步、協作編輯、版本控制
- [ ] 進階 AI 功能 - 劇情分析、角色一致性檢查、創意建議

## 🤝 貢獻指南

歡迎參與「創世紀元：異世界創作神器」的開發！

### 開發流程

1. Fork 此專案
2. 創建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 編寫代碼並添加測試
4. 執行測試確保功能正常 (`npm test`)
5. 提交變更 (`git commit -m 'Add some AmazingFeature'`)
6. 推送到分支 (`git push origin feature/AmazingFeature`)
7. 開啟 Pull Request

### 代碼規範

- 使用 TypeScript 進行開發
- 遵循 ESLint 配置的代碼風格
- 為新功能添加對應的測試
- 保持代碼註釋的完整性
- 使用繁體中文進行註釋和文檔

## 授權

此專案採用 MIT 授權 - 詳見 [LICENSE](LICENSE) 文件

## 聯絡方式

如有問題或建議，請開啟 Issue 或聯絡開發團隊。

---

## 版本變更紀錄

- 0.3.7 (2025-07-26)：修復 IPC 處理器註冊問題，在 main.ts 中添加 setupIpcHandlers() 調用，解決「No handler registered for ai:listModels」錯誤，確保所有 IPC 功能正常工作
- 0.3.6 (2025-07-26)：修復 OLLAMA 模型獲取問題，整合現有 IPC API 系統，添加 fallback 機制確保兼容性，解決模型列表顯示「未找到模型」的問題
- 0.3.5 (2025-07-26)：優化 OLLAMA 模型選擇功能，改為動態獲取本地 OLLAMA 服務器中的實際模型列表，支援即時掃描和重新載入，提供更準確的模型管理
- 0.3.4 (2025-07-26)：增強 AI 引擎設定功能，添加 OLLAMA 模型選擇器，支援 13 種不同模型，新增服務器地址和 API 金鑰配置，完善 AI 設定界面
- 0.3.3 (2025-07-26)：修復系統設定頁面按鈕點擊功能，為所有設定區塊按鈕添加 onClick 事件處理器，完善用戶交互體驗
- 0.3.2 (2025-07-26)：完成全功能測試驗證，建立完整手動測試指南，更新 .gitignore 配置，所有核心功能運行穩定
- 0.3.1 (2025-07-26)：功能卡片全面恢復，完成創世神模式、英靈召喚、輕小說模板、系統設定、使用說明、資料管理等 8 大核心功能整合，穩定版本界面完善
- 0.3.0 (2025-07-26)：應用程式打包完成，全功能測試驗證通過，編輯器、導航、錯誤處理、界面響應性、創作統計等核心功能穩定可用
- 0.2.1 (2025-07-26)：穩定性重大提升，完全解決閃退問題，資料庫功能重構，IPC 通訊架構優化
- 0.2.0 (2025-07-26)：自動更新機制、使用者文檔、診斷工具、一鍵安裝
- 0.1.0 (2025-07-26)：初始化專案，核心 MVP 功能完成

---

**「喚醒內心的創世神，用 AI 之力編織異世界傳說！」**
